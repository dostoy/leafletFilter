L.TimeDimension.Layer.GeoJson.CustomLayer = L.TimeDimension.Layer.GeoJson.extend({

    _update: function() {
        L.TimeDimension.Layer.GeoJson.prototype._update.call(this);
        if (this._currentLayer) {
            this._currentLayer.bringToBack();
        }
    },

});

L.timeDimension.layer.geoJson.customLayer = function(layer, options) {
    return new L.TimeDimension.Layer.GeoJson.CustomLayer(layer, options);
};


var startDate = new Date();
startDate.setUTCHours(0, 0, 0, 0);

var map = L.map('map', {
    zoom: 12,
    fullscreenControl: true,
    center: [39.52, 2.39],
    timeDimension: true,
    timeDimensionControl: true,
});

$.getJSON("data/example_linestring.geojson", function(data) {
    var geojsonLayer = L.geoJson(data, {
        style: {
            "color": "#0b3b5f",
            "weight": 2
        }
    });
    geojsonLayer.addTo(map);
});

$.getJSON("data/example.geojson", function(data) {
    var geojsonLayer = L.geoJson(data, {
        style: (function(feature) {
            if (feature.geometry.type == 'Polygon') {
                return {
                    "color": "#FF0000",
                    "fillColor": "#eccdd1",
                    "weight": 1,
                    "opacity": 1,
                    "fillOpacity": 0.9,
                }
            }
            return {};
        })
    });
    var geojsonTimeLayer = L.timeDimension.layer.geoJson.customLayer(geojsonLayer, {
        updateTimeDimension: true,
        duration: "PT12H"
    });    
    geojsonTimeLayer.addTo(map);
});

var osmLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
});

var layersControl = L.control.layers({
    "OSM": osmLayer
}, {});
layersControl.addTo(map);
osmLayer.addTo(map);